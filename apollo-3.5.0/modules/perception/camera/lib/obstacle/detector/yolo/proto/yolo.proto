syntax = "proto2";

package apollo.perception.camera.yolo;

message YoloParam {
    optional ModelParam model_param = 1;
    optional NetworkParam net_param = 2;
    optional NMSParam nms_param = 3;
}

message ModelParam {
    optional string model_name = 1 [default = "yolo-2d"];
    optional string proto_file = 2 [default = "caffe.pt"];
    optional string weight_file = 3 [default = "caffe.md"];
    optional string stage1_pt = 21 [default = "caffe.pt"];
    optional string stage1_md = 22 [default = "caffe.md"];
    optional string stage2_pt = 23 [default = "caffe.pt"];
    optional string stage2_md = 24 [default = "caffe.md"];
    optional string anchors_file = 4 [default = "anchors.txt"];
    optional string types_file = 5 [default = "types.txt"];
    optional string feature_file = 6 [default = "feature.pt"];

    optional float offset_ratio = 7 [default = 0.288889];
    optional float cropped_ratio = 13 [default = 0.711111];
    optional int32 resized_width = 14 [default = 1440];
    optional int32 aligned_pixel = 15 [default = 32];
    optional float confidence_threshold = 8 [default = 0.1];
    optional float light_vis_conf_threshold = 33 [default = 0.5];
    optional float light_swt_conf_threshold = 34 [default = 0.5];
    optional float roi_conf_threshold = 25 [default = 0.1];
    optional float box_conf_threshold = 26 [default = 0.5];
    optional float stage2_nms_threshold = 27 [default = 0.4];
    optional float min_2d_height = 9 [default = 0.0];
    optional float min_3d_height = 30 [default = 0.0];
    optional float min_3d_width = 31 [default = 0.0];
    optional float min_3d_length = 32 [default = 0.0];
    optional string calibratetable_root = 11 [default = "./"];
    optional string model_type = 12 [default = "CaffeNet"];
    optional int32 ori_cycle = 16 [default = 1];
    optional bool per_cls_reg = 17 [default = false];
    repeated DimensionStatistics dimension_statistics = 18;
    repeated BBoxStatistics bbox_statistics = 19;
    optional string expand_file = 20 [default = "expand.txt"];
    optional bool with_box3d = 41 [default = false];
    optional bool with_frbox = 42 [default = false];
    optional bool with_lights = 43 [default = false];
    optional bool with_ratios = 44 [default = false];
    optional int32 num_areas = 46 [default = 0];
    optional float border_ratio = 45 [default = .01];
}

message NetworkParam {
    optional string loc_blob = 1 [default = "loc_pred"];
    optional string obj_blob = 2 [default = "obj_pred"];
    optional string cls_blob = 3 [default = "cls_pred"];
    optional string ori_blob = 4 [default = "ori_pred"];
    optional string dim_blob = 5 [default = "dim_pred"];
    optional string lof_blob = 6 [default = "lof_pred"];
    optional string lor_blob = 7 [default = "lor_pred"];
    optional string input_blob = 8 [default = "data"];
    optional string rois_blob = 10 [default = "rois_pred"];
    optional string feat_blob = 11 [default = "conv_feat"];
    optional string box_blob = 13 [default = "box_pred"];
    optional string iou_blob = 14 [default = "iou_pred"];
    optional string brvis_blob = 15 [default = "brvis_pred"];
    optional string brswt_blob = 16 [default = "brswt_pred"];
    optional string ltvis_blob = 17 [default = "ltvis_pred"];
    optional string ltswt_blob = 18 [default = "ltswt_pred"];
    optional string rtvis_blob = 19 [default = "rtvis_pred"];
    optional string rtswt_blob = 20 [default = "rtswt_pred"];
    optional string area_id_blob = 23 [default = "area_id_pred"];
    optional string visible_ratio_blob = 21 [default = "vis_pred"];
    optional string cut_off_ratio_blob = 22 [default = "cut_pred"];
}

message NMSParam {
    optional string type = 1 [default = "NormalNMS"];
    optional float threshold = 2 [default = 0.4];
    optional float sigma = 3 [default = 0.4];
    optional float inter_cls_conf_thresh = 4 [default = 0.1];
    optional float inter_cls_nms_thresh = 5 [default = 1.0];
}

message BBoxStatistics {
  repeated float mean = 1;
  repeated float std = 2;
}

message DimensionStatistics {
    optional float mean_h = 1 [default = 0.0];
    optional float mean_w = 2 [default = 0.0];
    optional float mean_l = 3 [default = 0.0];
    optional float std_h = 4 [default = 1.0];
    optional float std_w = 5 [default = 1.0];
    optional float std_l = 6 [default = 1.0];
}
